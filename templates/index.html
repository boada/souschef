{% extends "base.html" %}

{% block title %}Recipe Library - souschef.ai{% endblock %}

{% block content %}
<div class="page-header">
    <h2>My Recipe Library</h2>
    <a href="/add-recipe" class="btn btn-primary">+ Add Recipe</a>
</div>

{% if recipes %}
<div class="recipe-grid">
    {% for recipe in recipes %}
    <div class="recipe-card">
        {% if recipe.image_url %}
        <img src="{{ recipe.image_url }}" alt="{{ recipe.title }}" class="recipe-image">
        {% else %}
        <div class="recipe-image-placeholder">üç≥</div>
        {% endif %}
        
        <div class="recipe-card-content">
            <h3><a href="/recipe/{{ recipe.id }}">{{ recipe.title }}</a></h3>
            
            <div class="recipe-meta">
                {% if recipe.servings %}
                <span>üçΩÔ∏è {{ recipe.servings }} servings</span>
                {% endif %}
                {% if recipe.total_time %}
                <span>‚è±Ô∏è {{ recipe.total_time }} min</span>
                {% endif %}
            </div>
            
            <div class="recipe-source">
                <small>from {{ recipe.source_website }}</small>
            </div>
            
            <!-- Status badge -->
            {% if recipe.status == 'processing' %}
            <div class="status-badge status-processing">
                <span class="spinner">‚è≥</span> Processing ingredients...
            </div>
            {% elif recipe.status == 'ready_for_review' %}
            <div class="status-badge status-ready">
                ‚úÖ Ready for review
            </div>
            {% endif %}
            
            <div class="recipe-actions">
                {% if recipe.status == 'processing' %}
                    <button class="btn btn-small" disabled>Processing...</button>
                {% elif recipe.status == 'ready_for_review' %}
                    <a href="/review-recipe/{{ recipe.id }}" class="btn btn-small btn-primary">Review</a>
                {% else %}
                    <a href="/recipe/{{ recipe.id }}" class="btn btn-small">View</a>
                {% endif %}
                
                <button onclick="deleteRecipe({{ recipe.id }}, this.getAttribute('data-title'))" 
                        data-title="{{ recipe.title }}"
                        class="btn btn-small btn-danger">Delete</button>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <p>üì≠ No recipes yet!</p>
    <p>Start by <a href="/add-recipe">adding a recipe from a URL</a></p>
</div>
{% endif %}

{% endblock %}

{% block scripts %}
<script>
// Auto-refresh page if any recipes are processing
{% set has_processing = namespace(value=false) %}
{% for recipe in recipes %}
  {% if recipe.status == 'processing' %}
    {% set has_processing.value = true %}
  {% endif %}
{% endfor %}

{% if has_processing.value %}
setTimeout(() => {
    location.reload();
}, 3000); // Refresh every 3 seconds
{% endif %}

function deleteRecipe(recipeId, title) {
    if (!confirm(`Delete "${title}"?`)) {
        return;
    }
    
    fetch(`/recipe/${recipeId}/delete`, {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('Error deleting recipe: ' + (data.error || 'Unknown error'));
        }
    })
    .catch(error => {
        alert('Error: ' + error);
    });
}
</script>
{% endblock %}
